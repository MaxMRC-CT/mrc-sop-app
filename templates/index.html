{% extends "base.html" %}
{% block content %}

<div class="flex flex-col gap-6">
  <div class="bg-[#2f3640] border border-white/10 rounded-2xl p-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div>
        <h1 class="text-2xl font-semibold">My Snapshot</h1>
        <p class="text-sm text-white/60">Role: {{ role_label }}</p>
      </div>
      <div class="text-xs text-white/50">Everything you need to complete, in one place.</div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-5">
      <div class="bg-[#262c34] border border-white/10 rounded-2xl p-5">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm text-white/60">Policy & Procedure Signoffs</div>
            <div class="text-2xl font-semibold">{{ pending_sop_count }}</div>
          </div>
          <a href="/sops" class="text-orange-300 hover:underline text-sm">Go to P&amp;P</a>
        </div>
        <div class="mt-3">
          <div class="flex items-center justify-between text-xs text-white/50 mb-2">
            <span>{{ completed_sops }} of {{ total_sops }} completed</span>
            <span>{{ (completed_sops / total_sops * 100) | round(0) if total_sops else 0 }}%</span>
          </div>
          <div class="h-2 bg-white/10 rounded-full overflow-hidden">
            <div class="h-full bg-orange-400" style="width: {{ (completed_sops / total_sops * 100) | round(0) if total_sops else 0 }}%;"></div>
          </div>
        </div>
        <div class="mt-4 space-y-2">
          {% if pending_sops %}
            {% for sop in pending_sops %}
            <div class="flex items-center justify-between text-sm">
              <div>
                <div class="font-semibold">{{ sop.title }}</div>
                <div class="text-xs text-white/50">{{ sop.category }}</div>
              </div>
              <div class="flex items-center gap-3">
                {% if sop.overdue %}
                  <span class="text-xs text-amber-300">Overdue</span>
                {% else %}
                  <span class="text-xs text-white/50">Not started</span>
                {% endif %}
                <a class="text-orange-300 hover:underline text-xs" href="/sop/{{ sop.id }}">Review</a>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="text-sm text-white/60">All SOPs acknowledged and current.</div>
          {% endif %}
        </div>
      </div>

      <div class="bg-[#262c34] border border-white/10 rounded-2xl p-5">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm text-white/60">Learning Management</div>
            <div class="text-2xl font-semibold">{{ pending_module_count }}</div>
          </div>
          <a href="/learning" class="text-orange-300 hover:underline text-sm">Go to Learning</a>
        </div>
        <div class="mt-3">
          <div class="flex items-center justify-between text-xs text-white/50 mb-2">
            <span>{{ completed_modules }} of {{ total_modules }} completed</span>
            <span>{{ (completed_modules / total_modules * 100) | round(0) if total_modules else 0 }}%</span>
          </div>
          <div class="h-2 bg-white/10 rounded-full overflow-hidden">
            <div class="h-full bg-orange-400" style="width: {{ (completed_modules / total_modules * 100) | round(0) if total_modules else 0 }}%;"></div>
          </div>
        </div>
        <div class="mt-4 space-y-2">
          {% if pending_modules %}
            {% for m in pending_modules %}
            <div class="flex items-center justify-between text-sm">
              <div>
                <div class="font-semibold">{{ m.title }}</div>
                <div class="text-xs text-white/50">{{ m.status_label }}</div>
              </div>
              <div class="flex items-center gap-3">
                {% if m.overdue %}
                  <span class="text-xs text-amber-300">Overdue</span>
                {% else %}
                  <span class="text-xs text-white/50">Not started</span>
                {% endif %}
                <a class="text-orange-300 hover:underline text-xs" href="/learning/module/{{ m.id }}">Start</a>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="text-sm text-white/60">All training modules are completed.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if show_manager %}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <a href="/compliance" class="bg-[#2f3640] border border-white/10 rounded-2xl p-5 hover:shadow-lg hover:shadow-orange-500/10 transition">
      <div class="text-sm text-white/60 mb-2">Compliance</div>
      <div class="text-xl font-semibold">Reports & Oversight</div>
    </a>
    <a href="/hr" class="bg-[#2f3640] border border-white/10 rounded-2xl p-5 hover:shadow-lg hover:shadow-orange-500/10 transition">
      <div class="text-sm text-white/60 mb-2">HR</div>
      <div class="text-xl font-semibold">Staffing & Onboarding</div>
    </a>
    <a href="/admin" class="bg-[#2f3640] border border-white/10 rounded-2xl p-5 hover:shadow-lg hover:shadow-orange-500/10 transition">
      <div class="text-sm text-white/60 mb-2">Admin</div>
      <div class="text-xl font-semibold">SOP & Module Management</div>
    </a>
  </div>
  {% endif %}
</div>

{% endblock %}
